name: Documentación Automática

on:
  issues:
    types: [opened, closed, edited, labeled, unlabeled]
  pull_request:
    types: [opened, closed, edited, labeled, unlabeled, merged]
  milestone:
    types: [created, closed, edited, opened]
  workflow_dispatch:

jobs:
  docgen:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Instalar dependencias
        run: pip install pyyaml requests
      - name: Obtener datos de GitHub
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GITHUB_REPOSITORY: ${{ github.repository }}
        run: python scripts/fetch_github_data.py
      - name: Generar documentación para Pages
        run: python scripts/generate_docs.py
      - name: Generar documentación para Wiki
        run: python scripts/generate_wiki.py
      - name: Crear Pull Request automático
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "docs: actualización automática de documentación"
          branch: docs-auto
          base: main
          title: "Actualización automática de documentación"
          body: "Este PR actualiza la documentación generada automáticamente tras cambios en issues, PRs o milestones."
      - name: Subir cambios a la Wiki
        if: github.ref == 'refs/heads/main'
        uses: docker://decathlon/wiki-page-creator-action:latest
        with:
          path: wiki
          token: ${{ secrets.GITHUB_TOKEN }}
